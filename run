#!/bin/bash
# run - Main entry point for ZKVM testing

set -e

CMD=${1:-help}
shift || true

case "$CMD" in
    build)
        echo "🔨 Building ZKVMs: ${@:-all}"
        ./scripts/build.sh "$@"
        ;;
    
    test)
        echo "🧪 Testing ZKVMs: ${@:-all}"
        ./scripts/test.sh "$@"
        python3 scripts/update.py
        ;;
    
    update)
        echo "📊 Updating dashboard"
        python3 scripts/update.py
        ;;
    
    all)
        echo "🚀 Building and testing: ${@:-all}"
        ./scripts/build.sh "$@"
        ./scripts/test.sh "$@"
        python3 scripts/update.py
        ;;
    
    verify)
        echo "✅ Running verification"
        ./scripts/verify.sh
        ;;
    
    serve)
        echo "🌐 Server at http://localhost:8000"
        echo "   Press Ctrl+C to stop"
        cd docs && python3 -m http.server 8000
        ;;
    
    clean)
        echo "🧹 Cleaning artifacts"
        rm -rf binaries/ test-results/*/
        ;;
    
    *)
        cat << EOF
Usage: ./run COMMAND [TARGETS]

Commands:
  build [zkvm]  - Build ZKVM binaries
  test [zkvm]   - Run RISCOF tests  
  update        - Regenerate dashboard HTML
  all [zkvm]    - Build + test + update
  verify        - Run regression tests
  serve         - Start local web server
  clean         - Remove build artifacts

Examples:
  ./run build sp1        # Build just SP1
  ./run test sp1 jolt    # Test SP1 and Jolt
  ./run all              # Build and test everything
  ./run verify           # Check system integrity
EOF
        ;;
esac